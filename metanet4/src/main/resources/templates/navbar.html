<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>๋ค๋น๊ฒ์ด์ ๋ฐ</title>
    <script src="/js/refresh.js"></script>  <!-- โ refresh.js ์ถ๊ฐ -->
    <script>
    function checkLoginStatus() {
        fetch("/auth/check", { 
            method: "GET", 
            credentials: "include"  // โ ์ฟํค ํฌํจ
        })
        .then(response => {
            if (response.status === 403) {
                console.warn("๐ด 403 Forbidden: ์ธ์ฆ๋์ง ์์. Access Token ๊ฐฑ์ ์๋");
                return fetch("/auth/refresh", { method: "POST", credentials: "include" });
            }
            return response.json();
        })
        .then(data => {
            if (data.loggedIn) {
                console.log("๐ข ๋ก๊ทธ์ธ ์ํ ํ์ธ ์ฑ๊ณต:", data);
                document.getElementById("loginButton").style.display = "none";
                document.getElementById("signupButton").style.display = "none";
                document.getElementById("logoutButton").style.display = "inline";
                document.getElementById("profileButton").style.display = "inline";

                if (data.role === "ROLE_ADMIN") {
                    document.getElementById("adminButton").style.display = "inline";
                } else {
                    document.getElementById("adminButton").style.display = "none";
                }
            } else {
                document.getElementById("loginButton").style.display = "inline";
                document.getElementById("signupButton").style.display = "inline";
                document.getElementById("logoutButton").style.display = "none";
                document.getElementById("profileButton").style.display = "none";
                document.getElementById("adminButton").style.display = "none";
            }
        })
        .catch(error => {
            console.error("โ ๋ก๊ทธ์ธ ์ํ ํ์ธ ์คํจ:", error);
        });
    }


        function logout() {
            fetch("/auth/logout", { method: "POST", credentials: "include" })
            .then(() => {
                alert("๋ก๊ทธ์์ ๋์์ต๋๋ค.");
                window.location.href = "/auth/login";
            })
            .catch(error => alert("๋ก๊ทธ์์ ์คํจ: " + error.message));
        }

        window.onload = checkLoginStatus;
    </script>
</head>
<body>
    <nav>
        <ul>
            <li><a href="/">ํ</a></li>
            <li><a href="/auth/signup" id="signupButton">ํ์๊ฐ์</a></li>
            <li><a href="/auth/login" id="loginButton">๋ก๊ทธ์ธ</a></li>
            <li><button id="logoutButton" onclick="logout()" style="display: none;">๋ก๊ทธ์์</button></li>
            <li><a href="/user/profile" id="profileButton" style="display: none;">๋ด ์๋ณด</a></li>
            <li><a href="/admin/user-management" id="adminButton" style="display: none;">์ฌ์ฉ์ ๊ด๋ฆฌ</a></li>
        </ul>
    </nav>
</body>
</html>
