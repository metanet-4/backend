<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.metanet.team4.member.mapper.MemberMapper">

    <!-- ✅ userId로 회원 정보 조회 -->
    <resultMap id="memberResultMap" type="com.metanet.team4.member.model.Member">
	    <result column="USER_ID" property="userId"/>
	    <result column="NAME" property="name"/>
	    <result column="PASSWORD" property="password"/>
	    <result column="EMAIL" property="email"/>
	    <result column="ROLE" property="role"/>
	</resultMap>

	<select id="findByUserId" resultMap="memberResultMap">
	    SELECT USER_ID, NAME, PASSWORD, EMAIL, ROLE 
	    FROM MEMBER 
	    WHERE USER_ID = #{userId}
	</select>


    <!-- ✅ 회원 가입 -->
    <insert id="insertMember" parameterType="com.metanet.team4.member.model.Member">
        <selectKey keyProperty="id" resultType="Long" order="BEFORE">
            SELECT MEMBER_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO MEMBER (ID, USER_ID, PASSWORD, NAME, PHONE, EMAIL, BIRTHDAY, GENDER, ROLE, IMAGE, DISABILITY_CERTIFICATE, IS_DISCOUNTED)
        VALUES (#{id}, #{userId}, #{password}, #{name}, #{phone}, #{email}, #{birthday, jdbcType=DATE}, #{gender}, #{role}, #{image}, #{disabilityCertificate}, #{isDiscounted})
    </insert>

    <!-- ✅ 전체 사용자 조회 -->
    <select id="selectAllMembers" resultType="com.metanet.team4.member.model.Member">
        SELECT * FROM MEMBER
    </select>

    <!-- ✅ 사용자 권한 변경 -->
    <update id="updateUserRole">
        UPDATE MEMBER SET ROLE = #{role} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 사용자 삭제 -->
    <delete id="deleteMemberById">
        DELETE FROM MEMBER WHERE USER_ID = #{userId}
    </delete>

    <!-- ✅ 사용자 정보 업데이트 -->
    <update id="updateMember" parameterType="com.metanet.team4.member.model.Member">
        UPDATE MEMBER
        SET NAME = #{name}, PHONE = #{phone}, EMAIL = #{email}, BIRTHDAY = #{birthday}, GENDER = #{gender}, ROLE = #{role}, IMAGE = #{image}, DISABILITY_CERTIFICATE = #{disabilityCertificate}, IS_DISCOUNTED = #{isDiscounted}
        WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 비밀번호 변경 -->
    <update id="updatePassword">
        UPDATE MEMBER SET PASSWORD = #{password} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 프로필 사진 변경 -->
    <update id="updateProfilePic">
        UPDATE MEMBER SET IMAGE = #{image} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 장애인 인증서 파일 경로 저장 -->
    <update id="updateDisabilityCertificate">
        UPDATE MEMBER SET DISABILITY_CERTIFICATE = #{disabilityCertificate} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 관리자: 우대 여부 승인 -->
    <update id="approveDiscount">
        UPDATE MEMBER SET IS_DISCOUNTED = 1 WHERE USER_ID = #{userId}
    </update>

</mapper>
