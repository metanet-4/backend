<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.metanet.team4.member.mapper.MemberMapper">

    <!-- ✅ 모든 사용자 조회 (관리자 전용) -->
    <select id="selectAllMembers" resultType="com.metanet.team4.member.model.Member">
        SELECT * FROM member ORDER BY USER_ID
    </select>

    <!-- ✅ 사용자 정보 조회 -->
    <select id="findByUserid" parameterType="string" resultType="com.metanet.team4.member.model.Member" useCache="false">
        SELECT * FROM member WHERE USER_ID = #{userId}
    </select>

    <!-- ✅ 회원 가입 -->
    <insert id="insertMember" parameterType="com.metanet.team4.member.model.Member">
	    <selectKey keyProperty="id" resultType="Long" order="BEFORE">
	        SELECT MEMBER_SEQ.NEXTVAL FROM DUAL
	    </selectKey>
	    INSERT INTO MEMBER (ID, USER_ID, PASSWORD, NAME, PHONE, EMAIL, BIRTHDAY, GENDER, DISABILITY_CERTIFICATE)
	    VALUES (#{id}, #{userId}, #{password}, #{name}, #{phone}, #{email}, #{birthday, jdbcType=DATE}, #{gender}, #{disabilityCertificate})
	</insert>



    <!-- ✅ 사용자 역할 변경 -->
    <update id="updateUserRole">
        UPDATE member SET ROLE = #{role} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 사용자 삭제 -->
    <delete id="deleteMemberById">
        DELETE FROM member WHERE USER_ID = #{userId}
    </delete>

    <!-- ✅ 비밀번호 변경 -->
    <update id="updatePassword">
        UPDATE member SET PASSWORD = #{password} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 프로필 사진 변경 -->
    <update id="updateProfilePic">
        UPDATE member SET IMAGE = #{image} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 장애인 인증서 파일 경로 저장 -->
    <update id="updateDisabilityCertificate">
        UPDATE member SET DISABILITY_CERTIFICATE = #{disabilityCertificate} WHERE USER_ID = #{userId}
    </update>

    <!-- ✅ 관리자: 우대 여부 승인 -->
    <update id="approveDiscount">
        UPDATE member SET IS_DISCOUNTED = 1 WHERE USER_ID = #{userId}
    </update>

</mapper>
